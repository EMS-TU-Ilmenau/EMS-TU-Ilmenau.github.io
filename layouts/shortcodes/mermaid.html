<div id="{{ .Get "id" | default (printf "mermaid-%d" (now.UnixNano)) }}"></div>

<!-- Mermaid + ELK laden -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mermaid-js/mermaid@11.12.1/dist/elk.bundled.js"></script>

<script>
  (function() {
    const id = "{{ .Get "id" | default (printf "mermaid-%d" (now.UnixNano)) }}";
    const version = mermaid.version;

    // Diagrammtext aus Shortcode-Inhalt
    let diagramDefinition = `{{ .Inner | safeJS }}`;

    // Optional: Version als Knoten im Diagramm hinzufügen
    diagramDefinition += `
      %% Automatisch hinzugefügt: Mermaid Version ${version}
      subgraph MERMAID_VERSION
        V[Mermaid ${version}]
      end
    `;

    // Mermaid initialisieren
    mermaid.initialize({
      startOnLoad: false,
      theme: '{{ .Get "theme" | default "neutral" }}',
      themeVariables: {
        lineColor: '{{ .Get "lineColor" | default "gray" }}'
      },
      flowchart: {
        layout: '{{ .Get "layout" | default "elk" }}'
      }
    });

    // Diagramm rendern
    mermaid.render(id, diagramDefinition, function(svgCode) {
      document.getElementById(id).innerHTML = svgCode;
    });
  })();
</script>
